name: Validate Model Catalog

on:
  pull_request:
    paths:
      - 'catalog/models.json'
      - 'catalog/schema.json'
      - 'scripts/validate_catalog.py'
  push:
    branches:
      - main
    paths:
      - 'catalog/models.json'
      - 'catalog/schema.json'

jobs:
  validate:
    runs-on: ubuntu-latest
    name: Validate catalog/models.json
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: Run catalog validation
        run: |
          python scripts/validate_catalog.py
      
      - name: Check for dated model IDs
        run: |
          # Verify models use dated IDs (YYYYMMDD pattern)
          echo "Checking for dated model IDs..."
          python -c "
import json
import re
import sys

with open('catalog/models.json') as f:
    catalog = json.load(f)

errors = []
dated_pattern = re.compile(r'\\d{8}')  # YYYYMMDD

for provider, models in catalog['providers'].items():
    for model_id in models.keys():
        # Skip if model ID contains a date (YYYYMMDD)
        if not dated_pattern.search(model_id):
            # Allow some exceptions for stable aliases
            if model_id not in ['gpt-4o', 'gpt-4o-mini', 'deepseek-chat', 'deepseek-reasoner']:
                errors.append(f'{provider}/{model_id}: Missing dated ID (should contain YYYYMMDD)')

if errors:
    print('‚ùå Found models without dated IDs:')
    for error in errors:
        print(f'   - {error}')
    print()
    print('üí° TIP: Use provider\\'s official dated model IDs (e.g., claude-3-haiku-20240307)')
    sys.exit(1)
else:
    print('‚úì All models use dated IDs or approved aliases')
          "
      
      - name: Report validation success
        if: success()
        run: |
          echo "‚úÖ Catalog validation passed!"
          echo "Models can be safely merged."
